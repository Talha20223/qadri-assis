<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>qadri homeopathic assistant</title>
  <style>
  
  ::selection{
    background-color:#59c76b;
  }

/* General Reset and Font */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: Arial, sans-serif;
}

#tts-toggle{
  border-radius:30px;

}

body {
  background: linear-gradient(135deg, #ece9e6, #ffffff);
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
}

/* Title Bar */
.title-bar {
  position: fixed;
  top: 0;
  width: 100%;
  max-width: 100%;
  background: rgba(255, 255, 255, 0.6); /* Acrylic Effect */
  backdrop-filter: blur(10px);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);

  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 100;
}

.title-bar h1 {
  font-size: 1.5rem;
  color: #333;
  text-align:center;
}

/* TTS Toggle */
.tts-toggle {
  font-size: 0.9rem;
  border-radius:20px;
}

/* Chat Container */
#chat-container {
  margin-top: 70px; /* Space for title bar */
  width: 100%;
  height: calc(100vh - 150px); /* Full screen minus title and input areas */
  background: rgba(255, 255, 255, 0.6); /* Acrylic Effect */
  backdrop-filter: blur(10px);
  border-radius: 15px;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

#chat-container div {
  margin-bottom: 10px;
  padding: 10px 15px;
  border-radius: 20px;
  max-width: 75%;
  word-wrap: break-word;
}

#chat-container .user {
  align-self: flex-end;
  background: #007bff;
  color: white;
  animation: fadeIn 0.3s ease-out;
}

#chat-container .bot {
  align-self: flex-start;
  background: #f1f1f1;
  color: #333;
  animation: fadeIn 0.3s ease-out;
}

/* Floating Input Styles */
.input-container {
  display: flex;
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  max-width: 500px;
  background: rgba(255, 255, 255, 0.8); /* Acrylic Effect */
  backdrop-filter: blur(10px);
  border-radius: 50px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  padding: 10px;
  z-index: 100;
}

#message-input {
  flex-grow: 1;
  border: none;
  padding: 10px 15px;
  border-radius: 50px;
  outline: none;
  background-color: transparent;
  color: #333;
  font-size: 1rem;
}

#message-input::placeholder {
  color: #999;
}

/* Image Send Button */
#send-button, #mic-button {
  border: none;
  background: transparent;
  cursor: pointer;
  margin-left: 10px;
}

#send-button img, #mic-button img {
  width: 40px;
  height: 40px;
}

/* Smooth animation for new messages */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Responsive design */
@media (max-width: 600px) {
  #chat-container {
    height: calc(100vh - 120px);
    padding: 15px;
  }

  .input-container {
    padding: 8px;
    max-width: 100%;
    bottom: 15px;
  }

  #message-input {
    padding: 8px 12px;
  }

  #send-button img, #mic-button img {
    width: 35px;
    height: 35px;
  }

  .title-bar h1 {
    font-size: 1.2rem;
  }
}

#qadri{
  height:80px;
  margin-right:40px;
}
#homeo{
  margin
}
a {
  color: #007bff;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

strong {
  font-weight: bold;
}
  
  
  
  /* From Uiverse.io by Lmickk2 */ 
.switch {
  font-size: 17px;
  position: relative;
  display: inline-block;
  width: 2em;
  height: 1.1em;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  box-shadow: inset 1px 2px 5px 1px rgba(0, 0, 0, 0.329);
  transition: .4s;
  border-radius: 30px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 0.5em;
  width: 0.5em;
  border-radius: 20px;
  left: 0.3em;
  bottom: 0.3em;
  background-color: rgb(255, 255, 255);
  transition: .4s;
}

.switch input:checked + .slider {
  background-color: #59c76b;
}

.switch input:focus + .slider {
  box-shadow: inset 3px 2px 4px rgba(22, 22, 22, 0.253);
}

.switch input:checked + .slider:before {
  transform: translateX(1em);
}

</style>
</head>
<body>
  <!-- Floating Title Bar -->
  <span class="title-bar">
<img id="qadri" src="https://i.ibb.co/M6fQ2vH/apple-touch-icon.png">
    <h1 id="homeo">

      Qadri homeopathic Assistant
      </h1>
    <div class="tts-toggle">
      <label class="switch" for="tts-toggle">
  <input type="checkbox" id="tts-toggle">
  <span class="slider"></span>
</label>
    </div>
  </span>

  <!-- Full-Screen Chat Area -->
  <div id="chat-container"></div>

  <!-- Floating Input Area -->
  <div class="input-container">
    <input type="text" id="message-input" placeholder="Enter your message">
    <!-- Image Send Button -->
    <button id="send-button">
      <svg width="30px" height="30px" viewBox="0 0 25.00 25.00" fill="none" xmlns="http://www.w3.org/2000/svg" transform="matrix(1, 0, 0, 1, 0, 0)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M2.33045 8.38999C0.250452 11.82 9.42048 14.9 9.42048 14.9C9.42048 14.9 12.5005 24.07 15.9305 21.99C19.5705 19.77 23.9305 6.13 21.0505 3.27C18.1705 0.409998 4.55045 4.74999 2.33045 8.38999Z" stroke="#000000" stroke-width="2.275" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M15.1999 9.12L9.41992 14.9" stroke="#000000" stroke-width="2.275" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
    <!-- Mic Button for Speech-to-Text -->
    <button id="mic-button">
      <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px" fill="#000000"><path d="M480-400q-50 0-85-35t-35-85v-240q0-50 35-85t85-35q50 0 85 35t35 85v240q0 50-35 85t-85 35Zm0-240Zm-40 520v-123q-104-14-172-93t-68-184h80q0 83 58.5 141.5T480-320q83 0 141.5-58.5T680-520h80q0 105-68 184t-172 93v123h-80Zm40-360q17 0 28.5-11.5T520-520v-240q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v240q0 17 11.5 28.5T480-480Z"/></svg>
    </button>
  </div>

<script>
const chatContainer = document.getElementById('chat-container');
const messageInput = document.getElementById('message-input');
const sendButton = document.getElementById('send-button');
const ttsToggle = document.getElementById('tts-toggle'); // TTS toggle checkbox
const micButton = document.getElementById('mic-button'); // Mic button for STT

let chatHistory = []; // Store the conversation history

sendButton.addEventListener('click', async () => {
  const message = messageInput.value;
  if (!message) return;

  appendMessage("user", message); // Add user message to UI
  messageInput.value = '';

  try {
    const response = await fetch('/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: message, history: chatHistory }), // Send history
    });

    const data = await response.json();
    if (response.ok) {
      appendMessage("bot", data.reply);
      chatHistory.push({ role: "user", text: message }); // Update History
      chatHistory.push({ role: "model", text: data.reply }); // Update History

      // Speak the bot's response if TTS is enabled
      if (ttsToggle.checked) {
        speak(data.reply);
      }
    } else {
      console.error("Error:", data.error || response.statusText);
      appendMessage("bot", "An error occurred."); // Display error message to the user
    }

  } catch (error) {
    console.error("Fetch error:", error);
    appendMessage("bot", "A network error occurred.");
  }
});

// Speech-to-text (STT) integration using Web Speech API
micButton.addEventListener('click', () => {
  const recognition = new(window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = 'en-US'; // Set language to English (can be customized)
  recognition.start();

  recognition.onresult = (event) => {
    const speechResult = event.results[0][0].transcript;
    messageInput.value = speechResult; // Populate the input with transcribed speech
  };

  recognition.onerror = (event) => {
    console.error('Speech recognition error', event.error);
  };
});

function speak(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = 'en-US'; // You can set this to other languages if needed
  speechSynthesis.speak(utterance);
}

function appendMessage(sender, text) {
  const messageDiv = document.createElement('div');
  messageDiv.classList.add(sender);
  messageDiv.innerHTML = formatText(text); // Use innerHTML to apply formatting
  chatContainer.appendChild(messageDiv);
  chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to the bottom
}

// Function to format text for bold and clickable links
function formatText(text) {
  // Convert *text* to <strong>text</strong>
  text = text.replace(/\*([^\*]+)\*/g, '<strong>$1</strong>');

  // Convert URLs to clickable links
  text = text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');

  return text;
}
  </script>
</body>
</html>